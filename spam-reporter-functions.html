<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>Zgłoś Spam - Funkcje</title>
    
    <!-- Office JS API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    
    <script type="text/javascript">
        // Inicjalizacja Office JS
        Office.onReady(function(info) {
            // Weryfikacja czy działa na urządzeniu mobilnym
            if (Office.context.platform !== Office.PlatformType.PC) {
                // Na urządzeniach mobilnych - wszystko ok
            } else {
                // Na komputerze - wyłączamy funkcjonalność
                console.log("Ta wtyczka jest przeznaczona tylko dla urządzeń mobilnych.");
            }
        });
        
        // Główna funkcja zgłaszania spamu
        function reportSpam() {
            // Sprawdzenie platformy - działa tylko na telefonach
            if (Office.context.platform === Office.PlatformType.PC) {
                // Jeśli na desktopie, wyświetl komunikat
                showNotification("Ta funkcja jest dostępna tylko na urządzeniach mobilnych.");
                return;
            }
            
            // Pobierz aktualną wiadomość
            Office.context.mailbox.item.getAsync(
                {
                    asyncContext: "reportSpam"
                },
                function(asyncResult) {
                    if (asyncResult.status === Office.AsyncResultStatus.Failed) {
                        showNotification("Nie udało się pobrać wiadomości: " + asyncResult.error.message);
                        return;
                    }
                    
                    // Pobierz wiadomość jako EML
                    var mailItem = asyncResult.value;
                    
                    // Przygotowanie treści zgłoszenia
                    var subject = "SPAM ALERT: " + Office.context.mailbox.item.subject;
                    var body = "Użytkownik " + Office.context.mailbox.userProfile.emailAddress + 
                              " oznaczył tę wiadomość jako spam. Prosimy o zablokowanie nadawcy w systemie bezpieczeństwa poczty.";
                    
                    // Załącznik to oryginalna wiadomość
                    var attachments = [{
                        type: "item",
                        itemId: Office.context.mailbox.item.itemId,
                        name: "original_spam_message.eml"
                    }];
                    
                    // Przesłanie wiadomości do działu bezpieczeństwa
                    Office.context.mailbox.displayNewMessageForm({
                        toRecipients: ["tomaszciszewski01@gmail.com"],
                        subject: subject,
                        htmlBody: body,
                        attachments: attachments
                    });
                    
                    // Powiadomienie użytkownika
                    showNotification("Wiadomość została zgłoszona jako spam");
                }
            );
        }
        
        // Pomocnicza funkcja do wyświetlania powiadomień
        function showNotification(message) {
            // W środowisku mobilnym użyj natywnego powiadomienia
            if (Office.context.mailbox.diagnostics.hostName === "Outlook_iOS" || 
                Office.context.mailbox.diagnostics.hostName === "Outlook_Android") {
                Office.context.mailbox.item.notificationMessages.addAsync("spamReportNotification", {
                    type: "informationalMessage",
                    message: message,
                    icon: "icon-16",
                    persistent: false
                });
            } else {
                // Dla innych środowisk użyj alertu
                alert(message);
            }
        }
        
        // Eksportowanie funkcji dla Office JS
        Office.actions.associate("reportSpam", reportSpam);
    </script>
</head>
<body>
    <!-- Pusta strona HTML - kod jest wykonywany w tle -->
</body>
</html>
