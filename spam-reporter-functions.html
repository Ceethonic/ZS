<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <title>Zgłoś Spam - Funkcje</title>
    
    <!-- Office JS API -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1.1/hosted/office.js"></script>
    
    <script type="text/javascript">
        // Inicjalizacja Office JS
        Office.onReady(function(info) {
            // Sprawdź parametry URL
            var urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('action') === 'reportSpam') {
                // Jeśli przyszliśmy z indeksu, wywołaj funkcję raportowania
                reportSpam();
            }
        });
        
        // Główna funkcja zgłaszania spamu
        function reportSpam() {
            try {
                // Przygotowanie treści zgłoszenia
                var subject = "SPAM ALERT: " + Office.context.mailbox.item.subject;
                var body = "Użytkownik " + Office.context.mailbox.userProfile.emailAddress + 
                          " oznaczył tę wiadomość jako spam. Prosimy o zablokowanie nadawcy w systemie bezpieczeństwa poczty.";
                
                // Załącznik to oryginalna wiadomość
                var attachments = [{
                    type: "item",
                    itemId: Office.context.mailbox.item.itemId,
                    name: "original_spam_message.eml"
                }];
                
                // Przesłanie wiadomości do działu bezpieczeństwa
                Office.context.mailbox.displayNewMessageForm({
                    toRecipients: ["tomaszciszewski01@gmail.com"],
                    subject: subject,
                    htmlBody: body,
                    attachments: attachments
                });
                
                // Powiadomienie użytkownika
                showNotification("Wiadomość została zgłoszona jako spam");
                
                // Wyświetl potwierdzenie na stronie
                document.getElementById("confirmation").style.display = "block";
            } catch (error) {
                console.error("Błąd zgłaszania spamu:", error);
                document.getElementById("error").textContent = "Wystąpił błąd: " + error.message;
                document.getElementById("error").style.display = "block";
            }
        }
        
        // Pomocnicza funkcja do wyświetlania powiadomień
        function showNotification(message) {
            try {
                // Próba użycia natywnych powiadomień Outlook
                if (Office.context.mailbox && Office.context.mailbox.item && 
                    Office.context.mailbox.item.notificationMessages) {
                    Office.context.mailbox.item.notificationMessages.addAsync("spamReportNotification", {
                        type: "informationalMessage",
                        message: message,
                        icon: "icon-16",
                        persistent: false
                    });
                } else {
                    // Alternatywnie wyświetl alert
                    alert(message);
                }
            } catch (error) {
                // W przypadku błędu, wyświetl alert
                alert(message);
            }
        }
        
        // Eksportowanie funkcji dla Office JS
        Office.actions.associate("reportSpam", reportSpam);
    </script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            color: #333;
            text-align: center;
        }
        h1 {
            font-size: 24px;
        }
        .message {
            margin: 20px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .confirmation {
            background-color: #e6f7e6;
            color: #2e7d32;
            display: none;
        }
        .error {
            background-color: #ffebee;
            color: #c62828;
            display: none;
        }
    </style>
</head>
<body>
    <h1>Zgłaszanie Spamu</h1>
    <div id="confirmation" class="message confirmation">
        Wiadomość została zgłoszona jako spam. Dziękujemy za pomoc w utrzymaniu bezpieczeństwa!
    </div>
    <div id="error" class="message error"></div>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93c8be752fbac079',t:'MTc0NjcwNTA3My4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
